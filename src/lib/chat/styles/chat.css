/* =================================================================
   CHAT CONTAINER (8pt Grid System)
   Main Chat Area: 800px max-width (правило третей)
   ================================================================= */

.chat {
  display: flex;
  flex-direction: column;
  min-height: 0;
  gap: 0;
  height: 100%;
  width: 100%;
  position: relative;
  background: #1a1f2e;
}

.chat {
  grid-row: 1;
}

/* Center content in the chat area */
.chat > * {
  margin-left: auto;
  margin-right: auto;
  max-width: var(--chat-max-width); /* 800px */
  width: 100%;
}

.loader {
  grid-row: 2;
}

/* =================================================================
   MESSAGES CONTAINER (8pt Grid aligned)
   Padding: 24px 32px desktop, 16px 24px mobile
   Gap: 0 (без расстояния между сообщениями)
   ================================================================= */

.messages {
  margin-top: 0;
  margin-left: auto;
  margin-right: auto;
  background: transparent;
  border: none;
  border-radius: 0;

  /* Mobile padding */
  padding: var(--message-padding-mobile); /* 16px 24px */
  padding-right: calc(var(--space-4) + var(--space-2)); /* подвинуть скроллбар внутрь */
  scrollbar-gutter: stable;

  flex: 1 1 auto;
  max-width: var(--chat-max-width); /* 800px */
  width: 100%;

  overflow: hidden auto;
  display: flex;
  flex-direction: column;
  gap: var(--message-gap); /* 0 */
  color: var(--text);

  /* Padding at bottom for composer space */
  padding-bottom: calc(160px + var(--space-4)); /* 160px + 24px */
}

/* Desktop: 24px 32px padding */
@media (min-width: 768px) {
  .messages {
    padding: var(--message-padding-desktop); /* 24px 32px */
    padding-right: calc(var(--space-5) + var(--space-2)); /* +8px справа для скроллбара */
    padding-bottom: calc(160px + var(--space-5)); /* 160px + 32px */
  }
}

/* =================================================================
   MESSAGE ROW (8pt Grid)
   ================================================================= */

.message {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
  max-width: 100%;
}

/* User messages align right */
.message.user {
  align-items: flex-end;
}

.message.assistant {
  align-items: flex-start;
}

.messages,
.message,
.bubble {
  min-width: 0;
}

.message {
  overflow-wrap: anywhere;
  word-break: break-word;
  margin-bottom: -16px; /* перекрытие между сообщениями */
}

/* =================================================================
   MESSAGE BUBBLE (8pt Grid aligned)
   Padding: 16px 24px, Border-radius: 12px
   ================================================================= */

.bubble {
  max-width: 100%;
  width: fit-content;
  padding: var(--space-3) var(--space-4); /* 16px 24px */
  border-radius: var(--message-border-radius); /* 12px */
  background: transparent;
  color: var(--text);
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
}

.bubble .rich {
  display: block;
  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  max-width: 100%;
  min-width: 0;
  font-size: var(--font-size-base); /* 16px */
  line-height: var(--line-height-normal); /* 1.5 = 24px */
}

/* User bubble: subtle background */
.message.user .bubble {
  background: var(--panel-bg);
  color: var(--text);
  border-radius: var(--message-border-radius); /* 12px базовый радиус */
  border-top-right-radius: 0; /* убираем скругление правого верхнего угла для пользовательских сообщений */
  max-width: var(--message-content-max-width); /* 736px */
}

/* Assistant bubble: clean, no background */
.message.assistant .bubble {
  background: transparent;
  padding-left: 0;
  padding-right: 0;
  max-width: 100%;
}

/* =================================================================
   TOGGLE SWITCH (8pt Grid aligned)
   Width: 48px (6 units), Height: 24px (3 units)
   Thumb centered vertically with transform
   ================================================================= */

.switch {
  position: relative;
  display: inline-block;
  width: var(--space-7); /* 48px - 6 units */
  height: var(--space-4); /* 24px - 3 units */
  flex-shrink: 0;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: default;
  inset: 0;
  background: color-mix(in srgb, var(--border-color) 40%, var(--panel-bg) 60%);
  transition: var(--transition-colors);
  border-radius: var(--radius-full);
  box-shadow: inset 0 1px var(--space-1) rgb(0 0 0 / 0.1); /* 4px → 3px */
}

.slider::before {
  position: absolute;
  content: '';
  height: var(--space-3); /* 16px → 20px, using 16px for proper centering */
  width: var(--space-3); /* 16px */
  left: var(--space-1); /* 4px */
  top: 50%;
  transform: translateY(-50%);
  background: white;
  transition: var(--transition-transform);
  border-radius: 50%;
  box-shadow: var(--shadow-sm);
}

.switch input:checked + .slider {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
}

.switch input:checked + .slider::before {
  transform: translateY(-50%) translateX(var(--space-4)); /* 24px */
}

.switch.disabled {
  opacity: 0.6;
  cursor: default;
}

/* =================================================================
   SEGMENTED TOGGLE (8pt Grid aligned)
   ================================================================= */

.segmented-toggle {
  display: inline-flex;
  border: 1px solid var(--border-color);
  background: var(--panel-bg);
  border-radius: var(--radius-lg); /* 16px */
  overflow: hidden;
  padding: var(--space-1); /* 4px */
  gap: var(--space-1); /* 4px */
}

.segmented-toggle .segment {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2); /* 8px */
  padding: var(--space-1) var(--space-2); /* 4px 8px */
  border: none;
  background: transparent;
  color: var(--text);
  cursor: default;
  border-radius: var(--radius-md); /* 12px */
  transition: var(--transition-colors);
}

.segmented-toggle .segment.active {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: #ffffff;
}

.segmented-toggle .indicator.supported {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: #ffffff;
}

.segmented-toggle .segment:disabled {
  opacity: 0.6;
  cursor: default;
}

/* =================================================================
   CHAT PLACEHOLDER (8pt Grid aligned)
   ================================================================= */

.chat-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  flex: 1;
  min-height: 0;
  padding: var(--space-3); /* 16px */
  box-sizing: border-box;
  background: #1a1f2e;
  border-radius: var(--radius-lg); /* 16px */
  margin: 0;
}

.placeholder-content {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--space-3); /* 16px */
  text-align: left;
  color: var(--muted);
  background: transparent;
  border-radius: var(--radius); /* 8px */
}

.placeholder-content h3 {
  margin: 0;
  font-size: var(--font-size-lg); /* 20px */
  font-weight: var(--font-weight-semibold);
}

.placeholder-content .placeholder-text {
  display: flex;
  flex-direction: column;
  gap: var(--space-2); /* 8px */
}

.placeholder-content p {
  margin: 0;
  font-size: var(--font-size-sm); /* 14px */
  opacity: 0.8;
}

@media (min-width: 1024px) {
  /* Use flex layout for desktop to keep consistent heights (defined in base.css) */

  .wrap {
    display: flex;
    gap: 0;
    /* Sidebar handles its own border/gap */
    padding: 0;
    /* Main wrapper padding might interfere with sidebar */
    height: 100%;
    box-sizing: border-box;
  }

  /* Adjust chat section for larger screens */
  .chat {
    flex: 1 1 auto;
    grid-column: unset;
    grid-row: unset;
    min-height: 0;
    /* Ensure only the content is limited, not the container background */
    align-items: center;
    /* Helper to center direct children if they have width */
  }
}
