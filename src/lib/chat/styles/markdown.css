/* CoT / инструменты / markdown */
.cot {
  margin: 2px 0;
}

.cot > summary {
  cursor: default;
  color: var(--accent);
  font-weight: 600;
  display: inline-flex;
  align-items: baseline;
  gap: 8px;
  list-style: none;
  padding: 4px 0;
  user-select: none;
}

.cot > summary::-webkit-details-marker {
  display: none;
}

.cot > summary::marker {
  content: '';
}

.cot .caret-host {
  display: inline-flex;
  width: 16px;
  height: 16px;
  margin-left: 2px;
  transform: translateY(-1px);
}

.cot .caret-host svg {
  transition: transform 150ms ease;
  color: var(--accent);
  fill: currentColor;
}

.cot[open] .caret-host svg {
  transform: rotate(90deg);
  color: var(--accent);
}

.cot .brain-host {
  display: inline-flex;
  width: 16px;
  height: 16px;
  color: var(--accent);
  fill: currentColor;
  transform: translateY(-1px);
}

.cot .cot-label {
  transform: translateY(-4px);
  user-select: none;
}

.cot-pre {
  margin: 2px 0 12px 0;
  padding: 6px;
  background: var(--panel-bg);
  border-radius: 8px;
  overflow: auto;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
  max-width: 100%;
}

.tool-card, .tool-response {
  margin: 8px 0;
  padding: 10px;
  border-radius: 10px;
  background: var(--panel-alt-bg);
  border: 1px solid var(--border-color);
}

.tool-response {
  background: var(--panel-success-bg);
}

.tool-title {
  font-weight: 600;
  margin-bottom: 6px;
  color: var(--text);
}

.tool-pre {
  margin: 0;
  padding: 8px;
  background: var(--panel-bg);
  border-radius: 8px;
  overflow: auto;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
  max-width: 100%;
}

pre.code {
  margin: 8px 0;
  padding: 10px;
  background: var(--code-bg);
  color: var(--code-fg);
  border-radius: 8px;
  overflow: auto;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
  max-width: 100%;
}

pre.code code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: inherit;
  overflow-wrap: inherit;
  word-break: inherit;
}

.hljs, .hljs-subst {
  color: var(--code-fg);
}

.hljs-keyword, .hljs-selector-tag, .hljs-literal, .hljs-built_in {
  color: var(--code-keyword);
}

.hljs-string, .hljs-attr, .hljs-attribute, .hljs-template-variable {
  color: var(--code-string);
}

.hljs-title, .hljs-section, .hljs-selector-id, .hljs-name {
  color: var(--code-title);
}

.hljs-number, .hljs-symbol, .hljs-bullet {
  color: var(--code-number);
}

.hljs-variable, .hljs-template-tag {
  color: var(--code-variable);
}

.hljs-meta, .hljs-tag {
  color: var(--code-tag);
}

.hljs-comment, .hljs-quote {
  color: var(--code-comment);
  font-style: italic;
}

.md-stream {
  margin: 0;
  padding: 0;
  border: none;
  background: transparent;
  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  position: static;
}

.md-stream .md-controls {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  margin: 2px 0 0;
}

.md-stream .md-toggle {
  display: inline-flex;
  align-items: center;
  gap: 0;
  border: 1px solid var(--border-color);
  background: var(--panel-bg);
  color: var(--text);
  border-radius: 8px;
  padding: 4px 6px;
   cursor: default;
}

.md-stream .md-eye-host {
  display: inline-flex;
  width: 16px;
  height: 16px;
  color: var(--text);
  fill: currentColor;
}

.md-stream .md-toggle-text {
  display: none;
}

.md-stream .md-content {
  margin: 4px 4px 0 4px;
}

.md-stream .md-raw {
  display: none;
  margin: 8px 0;
  padding: 10px;
  background: var(--panel-bg);
  color: var(--text);
  border: 1px dashed var(--border-color);
  border-radius: 8px;
  overflow: auto;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
  max-width: 100%;
}

.md-stream.show-raw .md-content {
  display: none;
}

.md-stream.show-raw .md-raw {
  display: block;
}

.md-stream pre {
  margin: 8px 0;
  padding: 10px;
  background: var(--code-bg);
  color: var(--code-fg);
  border-radius: 8px;
  overflow: auto;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
  max-width: 100%;
}

.md-stream pre code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: inherit;
  overflow-wrap: inherit;
  word-break: inherit;
}

.md-stream pre code.hljs, pre.code code.hljs {
  background: transparent !important;
  color: inherit;
  padding: 0 !important;
}

.md-stream :not(pre) > code {
  background: var(--code-bg);
  color: var(--code-fg);
  padding: 0.15em 0.35em;
  border-radius: 6px;
}

.md-stream p {
  margin: 0.5em 0;
  line-height: 1.6;
}

/* Заголовки с правильной иерархией */
.md-stream h1, .md-stream h2, .md-stream h3, 
.md-stream h4, .md-stream h5, .md-stream h6 {
  margin: 1.2em 0 0.6em;
  font-weight: 600;
  line-height: 1.25;
  color: var(--text);
}

.md-stream h1 {
  font-size: 2em;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 0.3em;
}

.md-stream h2 {
  font-size: 1.5em;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 0.3em;
}

.md-stream h3 {
  font-size: 1.25em;
}

.md-stream h4 {
  font-size: 1em;
}

.md-stream h5 {
  font-size: 0.875em;
}

.md-stream h6 {
  font-size: 0.85em;
  color: var(--muted);
}

/* Списки с правильным отступом и стилизацией */
.md-stream ul, .md-stream ol {
  margin: 1em 0;
  padding-left: 2em;
  line-height: 1.6;
}

.md-stream ul ul, .md-stream ol ol, 
.md-stream ul ol, .md-stream ol ul {
  margin: 0.25em 0;
  padding-left: 1.5em;
}

.md-stream li {
  margin: 0.25em 0;
}

.md-stream ul > li {
  list-style-type: disc;
}

.md-stream ul ul > li {
  list-style-type: circle;
}

.md-stream ul ul ul > li {
  list-style-type: square;
}

/* Списки задач (Task Lists) */
.md-stream input[type="checkbox"] {
  margin-right: 0.5em;
  accent-color: var(--accent);
}

.md-stream .task-list-item {
  list-style: none;
  margin-left: -1.5em;
}

/* Горизонтальные линии */
.md-stream hr {
  border: none;
  border-top: 1px solid var(--border-color);
  margin: 2em 0;
  height: 0;
}

/* Цитаты */
.md-stream blockquote {
  margin: 1em 0;
  padding: 0.5em 1em;
  border-left: 4px solid var(--accent);
  background: var(--panel-alt-bg);
  color: var(--text);
  font-style: italic;
}

.md-stream blockquote > :first-child {
  margin-top: 0;
}

.md-stream blockquote > :last-child {
  margin-bottom: 0;
}

/* Форматирование текста */
.md-stream strong, .md-stream b {
  font-weight: 600;
}

.md-stream em, .md-stream i {
  font-style: italic;
}

.md-stream s, .md-stream del {
  text-decoration: line-through;
  color: var(--muted);
}

.md-stream u, .md-stream ins {
  text-decoration: underline;
  text-decoration-color: var(--accent);
}

.md-stream mark {
  background: var(--accent);
  color: var(--bg);
  padding: 0.1em 0.2em;
  border-radius: 0.2em;
}

.md-stream small {
  font-size: 0.875em;
  color: var(--muted);
}

.md-stream sub, .md-stream sup {
  font-size: 0.75em;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

.md-stream sub {
  bottom: -0.25em;
}

.md-stream sup {
  top: -0.5em;
}

/* Клавиши */
.md-stream kbd {
  display: inline-block;
  padding: 0.1em 0.4em;
  font-size: 0.875em;
  color: var(--text);
  background: var(--panel-bg);
  border: 1px solid var(--border-color);
  border-radius: 0.25em;
  box-shadow: 0 1px 0 var(--border-color);
  font-family: ui-monospace, SFMono-Regular, monospace;
}

/* Переменные и семплы */
.md-stream var {
  font-style: italic;
  color: var(--accent);
  font-family: ui-monospace, SFMono-Regular, monospace;
}

.md-stream samp {
  font-family: ui-monospace, SFMono-Regular, monospace;
  background: var(--code-bg);
  color: var(--code-fg);
  padding: 0.1em 0.3em;
  border-radius: 0.25em;
}

/* Аббревиатуры */
.md-stream abbr {
  text-decoration: underline dotted;
  cursor: help;
}

/* Цитирования */
.md-stream cite {
  font-style: italic;
  color: var(--muted);
}

.md-stream q {
  quotes: '"' '"' ''' ''';
}

.md-stream q::before {
  content: open-quote;
}

.md-stream q::after {
  content: close-quote;
}

/* Определения */
.md-stream dfn {
  font-style: italic;
  font-weight: 600;
}

/* Время */
.md-stream time {
  color: var(--muted);
  font-variant-numeric: tabular-nums;
}

/* Данные */
.md-stream data {
  color: var(--accent);
  font-family: ui-monospace, SFMono-Regular, monospace;
}

/* Ссылки */
.md-stream a {
  color: var(--accent);
  text-decoration: underline;
  text-underline-offset: 0.2em;
}

.md-stream a:hover {
  text-decoration-thickness: 2px;
}

.md-stream a:visited {
  color: var(--accent-dim, var(--accent));
}

/* Изображения */
.md-stream img {
  max-width: 100%;
  height: auto;
  border-radius: 0.5em;
  margin: 0.5em 0;
}

.md-stream figure {
  margin: 1em 0;
  text-align: center;
}

.md-stream figcaption {
  margin-top: 0.5em;
  color: var(--muted);
  font-style: italic;
  font-size: 0.9em;
}

/* Детали и раскрывающиеся секции */
.md-stream details {
  margin: 1em 0;
  border: 1px solid var(--border-color);
  border-radius: 0.5em;
  overflow: hidden;
}

.md-stream summary {
  padding: 0.75em 1em;
  background: var(--panel-alt-bg);
  cursor: pointer;
  font-weight: 600;
  user-select: none;
  border-bottom: 1px solid var(--border-color);
}

.md-stream summary:hover {
  background: var(--panel-bg);
}

.md-stream details[open] summary {
  border-bottom: 1px solid var(--border-color);
}

.md-stream details > :not(summary) {
  padding: 1em;
}

.md-stream details > :not(summary):first-of-type {
  margin-top: 0;
}

.md-stream details > :not(summary):last-child {
  margin-bottom: 0;
}

/* Списки определений */
.md-stream dl {
  margin: 1em 0;
}

.md-stream dt {
  font-weight: 600;
  margin-top: 1em;
}

.md-stream dt:first-child {
  margin-top: 0;
}

.md-stream dd {
  margin: 0.5em 0 1em 2em;
  color: var(--text);
}

/* Адреса */
.md-stream address {
  font-style: italic;
  margin: 1em 0;
  padding: 0.5em;
  border-left: 4px solid var(--border-color);
  background: var(--panel-alt-bg);
}

/* Таблицы с полной стилизацией */
.md-stream table {
  width: 100%;
  max-width: 100%;
  border-collapse: collapse;
  margin: 1em 0;
  background: var(--bg);
  border: 1px solid var(--border-color);
  border-radius: 0.5em;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.md-stream table caption {
  padding: 0.75em;
  color: var(--muted);
  font-weight: 600;
  text-align: left;
  caption-side: top;
}

.md-stream thead {
  background: var(--panel-alt-bg);
}

.md-stream th, .md-stream td {
  border: 1px solid var(--border-color);
  padding: 0.75em 1em;
  text-align: left;
  vertical-align: top;
  word-wrap: break-word;
}

.md-stream th {
  font-weight: 600;
  color: var(--text);
  background: var(--panel-alt-bg);
  border-bottom: 2px solid var(--border-color);
}

.md-stream tbody tr:nth-child(even) {
  background: var(--panel-alt-bg);
}

.md-stream tbody tr:hover {
  background: var(--panel-bg);
}

.md-stream tfoot {
  background: var(--panel-alt-bg);
  font-weight: 600;
}

/* Выравнивание в таблицах */
.md-stream th[align="center"], .md-stream td[align="center"] {
  text-align: center;
}

.md-stream th[align="right"], .md-stream td[align="right"] {
  text-align: right;
}

.md-stream th[align="left"], .md-stream td[align="left"] {
  text-align: left;
}

/* Математические выражения */
.md-stream .math {
  display: inline-block;
  margin: 0 0.2em;
}

.md-stream .math.display {
  display: block;
  margin: 1em 0;
  text-align: center;
}

/* Ruby аннотации (для восточных языков) */
.md-stream ruby {
  position: relative;
  display: inline-block;
}

.md-stream rt {
  display: block;
  font-size: 0.6em;
  line-height: 1;
  text-align: center;
  margin-bottom: 0.2em;
}

.md-stream rp {
  display: none;
}

/* Поддержка RTL текста */
.md-stream [dir="rtl"] {
  direction: rtl;
  text-align: right;
}

.md-stream [dir="ltr"] {
  direction: ltr;
  text-align: left;
}

/* Responsive поведение таблиц */
@media (max-width: 480px) {
  .md-stream table {
    font-size: 0.875em;
  }
  
  .md-stream th, .md-stream td {
    padding: 0.5em;
  }
  
  /* Стекинг таблиц на мобильных */
  .md-stream table.stack-mobile {
    border: 0;
  }
  
  .md-stream table.stack-mobile thead {
    display: none;
  }
  
  .md-stream table.stack-mobile tr {
    border: 1px solid var(--border-color);
    display: block;
    margin-bottom: 0.5em;
    border-radius: 0.5em;
    overflow: hidden;
  }
  
  .md-stream table.stack-mobile td {
    border: none;
    display: block;
    text-align: right;
    padding: 0.5em;
    border-bottom: 1px solid var(--border-color);
  }
  
  .md-stream table.stack-mobile td::before {
    content: attr(data-label) ": ";
    float: left;
    font-weight: 600;
    color: var(--text);
  }
}

/* Accessibility improvements */
.md-stream :focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.md-stream [hidden] {
  display: none !important;
}

/* Print styles */
@media print {
  .md-stream {
    color: black;
    background: white;
  }
  
  .md-stream a {
    color: black;
    text-decoration: underline;
  }
  
  .md-stream code, .md-stream pre {
    background: #f5f5f5;
    border: 1px solid #ccc;
  }
  
  .md-stream blockquote {
    border-left: 4px solid #333;
    background: #f9f9f9;
  }
}

@media (prefers-color-scheme: dark) {
  .md-stream pre {
    background: var(--code-bg);
  }
}


