# Синхронизация версии приложения в модальном окне "О программе"

## Описание

Реализована автоматическая синхронизация номера версии приложения между файлом `Cargo.toml` и модальным окном "О программе" в интерфейсе пользователя.

## Реализация

### Backend (Rust)

Добавлена новая Tauri команда `get_app_info()` в файл `src-tauri/src/lib.rs`:

```rust
#[tauri::command]
fn get_app_info() -> serde_json::Value {
    serde_json::json!({
        "name": env!("CARGO_PKG_NAME"),
        "version": env!("CARGO_PKG_VERSION"),
        "authors": env!("CARGO_PKG_AUTHORS"),
        "description": env!("CARGO_PKG_DESCRIPTION"),
    })
}
```

Команда зарегистрирована в списке обработчиков команд Tauri и извлекает информацию о приложении из переменных окружения Cargo.

### Frontend (Svelte)

В компоненте `src/lib/components/Sidebar.svelte` добавлена логика для динамической загрузки версии:

```typescript
let showAbout = $state(false);
let appVersion = $state('0.13.0'); // Fallback версия

async function loadAppVersion() {
  try {
    const { invoke } = await import('@tauri-apps/api/core');
    const appInfo = await invoke('get_app_info');
    appVersion = appInfo.version;
  } catch (error) {
    console.warn('Не удалось получить версию приложения:', error);
    appVersion = '0.13.0'; // Fallback версия
  }
}

function toggleAbout() {
  showAbout = !showAbout;
  if (showAbout) {
    loadAppVersion(); // Загружаем версию при открытии модала
  }
}
```

### Отображение версии

В модальном окне версия отображается динамически:

```svelte
<p><strong>Версия:</strong> {appVersion}</p>
```

## Преимущества

1. **Автоматическая синхронизация** - версия всегда актуальна
2. **Единый источник истины** - версия берется из `Cargo.toml`
3. **Fallback механизм** - при ошибке загрузки используется резервная версия
4. **Ленивая загрузка** - версия загружается только при открытии модального окна

## Безопасность

Команда `get_app_info()` предоставляет только общедоступную информацию о приложении и не раскрывает конфиденциальные данные.

## Тестирование

Для тестирования функциональности создан файл `test_app_version.js`, который можно запустить в консоли браузера для проверки корректности работы команды.

### Ручное тестирование

1. Откройте приложение
2. Нажмите кнопку "ℹ️" в сайдбаре
3. В открывшемся модальном окне должна отображаться актуальная версия из `Cargo.toml`
4. Закройте и снова откройте модал - версия должна обновляться автоматически

## Обновление версии

Для обновления версии приложения достаточно изменить значение `version` в файле `src-tauri/Cargo.toml`. Изменения автоматически применятся к модальному окну при следующем запуске приложения.

```toml
[package]
name = "oxide-lab"
version = "0.14.0"  # <-- Измените здесь
description = "A Tauri App"
# ...
```

## Возможные ошибки и решения

### Ошибка "Tauri API недоступен"

**Причина**: Попытка использовать команду в веб-версии приложения
**Решение**: Убедитесь, что приложение запущено в Tauri окружении

### Ошибка загрузки версии

**Причина**: Проблемы с Tauri IPC или Rust кодом
**Решение**: Используется fallback версия "0.13.0", приложение продолжает работать

### Несоответствие версий

**Причина**: Разные версии в разных частях приложения
**Решение**: Всегда обновляйте версию только в `Cargo.toml`, она автоматически распространится на все компоненты

## Архитектурные решения

### Использование Tauri команд

Выбрано использование Tauri команд вместо жесткого кодирования для обеспечения:

- Единообразия данных
- Автоматической синхронизации
- Возможности тестирования
- Безопасности

### Ленивая загрузка

Версия загружается только при открытии модального окна для:

- Оптимизации производительности
- Снижения нагрузки на запуск приложения
- Минимизации сетевых запросов

### Fallback механизм

Реализован fallback на резервную версию для обеспечения работоспособности приложения даже при сбоях в загрузке реальной версии.

## Заключение

Реализация обеспечивает надежную синхронизацию версии приложения между backend и frontend с использованием современных веб-технологий и лучших практик разработки.
